Date.prototype.format=function(b){var c={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};if(/(y+)/.test(b)){b=b.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))}for(var a in c){if(new RegExp("("+a+")").test(b)){b=b.replace(RegExp.$1,RegExp.$1.length==1?c[a]:("00"+c[a]).substr((""+c[a]).length))}}return b};Class=new Object();Class.forName=function(fullNS){var nsArray=fullNS.split(".");var sEval="";var sNS="";for(var i=0;i<nsArray.length;i++){if(i!=0){sNS+="."}sNS+=nsArray[i];sEval+="if (typeof("+sNS+") == 'undefined') "+sNS+" = new Object();"}if(sEval!=""){eval(sEval)}};Class.forName("Kia.util");Kia.util={isDateFormat:function(c,d){if(c.length!=d.length){return false}var a=c;a=a.replace(/yyyy/,"[0-9]{4}");a=a.replace(/yy/,"[0-9]{2}");a=a.replace(/MM/,"((0[1-9])|1[0-2])");a=a.replace(/M/,"(([1-9])|1[0-2])");a=a.replace(/dd/,"((0[1-9])|([1-2][0-9])|30|31)");a=a.replace(/d/,"([1-9]|[1-2][0-9]|30|31))");a=a.replace(/HH/,"(([0-1][0-9])|20|21|22|23)");a=a.replace(/H/,"([0-9]|1[0-9]|20|21|22|23)");a=a.replace(/mm/,"([0-5][0-9])");a=a.replace(/m/,"([0-9]|([1-5][0-9]))");a=a.replace(/ss/,"([0-5][0-9])");a=a.replace(/s/,"([0-9]|([1-5][0-9]))");var b=new RegExp("^"+a+"$");return b.test(d)},parseDateTime:function(m,o){if(m.length!=o.length){return null}var b=m.indexOf("yyyy");var g=m.indexOf("MM");var a=m.indexOf("dd");var q=m.indexOf("HH");var i=m.indexOf("mm");var c=m.indexOf("ss");var l=new Date();try{if(b==-1||g==-1||a==-1){return null}var n=parseInt(o.substr(b,4));var j=parseInt(o.substr(g,2));var p=parseInt(o.substr(a,2));l.setFullYear(n,j-1,p);if(q!=-1){var h=parseInt(o.substr(q,2));l.setHours(h)}if(i!=-1){var f=parseInt(o.substr(f,2));l.setMinutes(f)}if(c!=-1){var e=parseInt(o.substr(c,2));l.setSeconds(e)}return l}catch(k){return null}},strToJson:function(jsonStr){return eval("("+jsonStr+")")},handleJsonResult:function(b,d){var g=b.msg||"";var f=b.title||"操作";var c=b.icon||"info";var e=b.action||"show";var a=false;if(e=="show"){$.messager.show({title:f,msg:g,timeout:5000,showType:"slide",showSpeed:500})}else{if(e=="alert"){$.messager.alert(f,g,c,d==null?function(){return true}:d)}else{if(e=="confirm"){$.messager.confirm(f,g,d==null?function(h){return h}:d)}else{if(e=="prompt"){$.messager.prompt(f,g,d==null?function(h){return h}:d)}}}}},getIframeContext:function(a){return"<iframe frameborder='0' src='"+a+"' style='width:100%;height:100%;overflow:hidden;'></iframe>"}};var SimpleDateFormat=function(formatString){this.formatString=formatString;this.monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"];this.dayNames=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];this.format=function(aDate){var localFormatString=formatString;localFormatString=localFormatString.replace(/Y{3,}/g,'" + (aDate.getFullYear()) + "');localFormatString=localFormatString.replace(/Y{2}/g,'" + ((aDate.getFullYear()).toString().substring(2)) + "');localFormatString=localFormatString.replace(/M{4,}/g,'" + (this.monthNames[aDate.getMonth()]) + "');localFormatString=localFormatString.replace(/M{3}/g,'" + ((this.monthNames[aDate.getMonth()]).substring(0,3)) + "');localFormatString=localFormatString.replace(/M{2}/g,'" + (aDate.getMonth()+101).toString().substring(1) + "');localFormatString=localFormatString.replace(/d{2}/g,'" + (aDate.getDate()+100).toString().substring(1) + "');localFormatString=localFormatString.replace(/F{2}/g,'" + (aDate.getDay()+100).toString().substring(1) + "');localFormatString=localFormatString.replace(/E{4,}/g,'" + (this.dayNames[aDate.getDay()]) + "');localFormatString=localFormatString.replace(/E{3}/g,'" + ((this.dayNames[aDate.getDay()]).substring(0,3)) + "');localFormatString=localFormatString.replace(/E{2}/g,'" + (aDate.getDay()+100).toString().substring(1) + "');localFormatString=localFormatString.replace(/H{2}/g,'" + (aDate.getHours()+100).toString().substring(1) + "');localFormatString=localFormatString.replace(/k{2}/g,'" + (aDate.getHours()+101).toString().substring(1) + "');localFormatString=localFormatString.replace(/m{2}/g,'" + (aDate.getMinutes()+100).toString().substring(1) + "');localFormatString=localFormatString.replace(/s{2}/g,'" + (aDate.getSeconds()+100).toString().substring(1) + "');localFormatString=localFormatString.replace(/S{2}/g,'" + (aDate.getMilliSeconds()+1000).toString().substring(1) + "');localFormatString='"'+localFormatString+'"';var formatedDate=eval(localFormatString);return(formatedDate)}};jQuery.fn.extend({kiaLoadFields:function(){$(this).find("input:enabled").each(function(){if($(this).hasClass("easyui-combobox")){$(this).combobox()}else{if($(this).hasClass("easyui-datebox")){$(this).datebox()}else{if($(this).hasClass("easyui-numberspinner")){$(this).datebox()}else{if($(this).hasClass("kia-combogrid")){$(this).kiaCombogrid()}else{if($(this).hasClass("kia-datebox")){$(this).kiaDatebox()}}}}}});return true},kiaIframe:function(a){$(this).html("<iframe scrolling='no' frameborder='0' src='"+a+"' style='width:100%;height:100%;overflow:hidden;'></iframe>")},kiaAuthFields:function(a){var b=$(this);if(!a){return false}b.find("input").each(function(){var d=$(this).attr("name")||null;if(d){var c=a[d];switch(c){case 0:$(this).addClass("invisible").attr("disabled","disabled");break;case 1:$(this).addClass("readonly").attr("readonly","true");break;default:$(this).addClass("editable")}}});return true},kiaCombogrid:function(){var d=$(this);var e=d.attr("name");var i=d.attr("valueField")||"id";var k=d.attr("textField")||"name";var o=d.attr("url")||"";var n=d.attr("required")||true;var b=d.attr("selecterWidth")||60;var h=d.attr("disabled");var m=d.attr("dataClass")||"";var j=d.width();var c=d.height();d.width(j-b);var f=d.val()||"";var g=$("<input>").width(b);d.before(g);d.combobox({hasDownArrow:false,editable:false,required:n,textField:k,valueField:i});g.combogrid({panelWidth:j,disabled:h,idField:i,textField:i,value:f,columns:[[{field:i,width:b},{field:k,width:j}]],onChange:function(p,q){if(!p||!q||p==q){return}d.combobox("select",p)},onSelect:function(p,q){d.combobox("select",q[i])}});var l=_comboData[m];if(l){var a=g.combogrid("grid");a.datagrid("loadData",l);d.combobox("loadData",l.rows)}},kiaDatebox:function(){var i=$(this);var j="yyyy-MM-dd";var c=i.attr("dateFormat")||"dd/MM/yyyy";var b=i.attr("value")||"";var k;if(b==""){k=""}else{var h=new Date(b);k=h.format(c);b=h.format(j);i.val(h.format(b))}var a=i.attr("name")||"";var f=$(this).width();var e=$("<input>").width(f);i.after(e);e.datebox({value:k,parser:function(m){var l=Kia.util.parseDateTime(c,m);return l==null?new Date():l},formatter:function(d){return d.format(c)},onSelect:function(d){i.val(d.format(j))}});var g=e.next().find("input:first");g.blur(function(){if($(this).val()==null||$(this).val()==""){return}var l=Kia.util.isDateFormat(c,$(this).val());if(l){var n=e.datebox("calendar");var m=n.calendar("options");var o=m.current;i.val(o.format(j))}else{$.messager.show({title:"输入错误",msg:"日期格式必须符合"+c});e.datebox("setValue",k);i.val(b)}})}});$.extend($.fn.validatebox.defaults.rules,{minLength:{validator:function(a,b){return a.length>=b[0]},message:"Please enter at least {0} characters."},datetime:{validator:function(b,c){var a=c[0]||"yyyy/MM/dd";return Kia.util.isDateFormat(a,b)},message:"日期格式必须符合 {0}"}});$.fn.datebox.defaults.formatter=function(a){if(a){return a.format("yyyy-MM-dd")}else{return""}};$.fn.datebox.defaults.parser=function(e){if(e){var b=e.split("-");try{var f=new Date(parseInt(b[0]),parseInt(b[1])-1,parseInt(b[2]));return f}catch(c){return new Date(e)}}else{return new Date()}};Class.forName("Kia.custom.setting");Kia.custom.setting={dbDateFormat:"yyyy-MM-dd",precision:2};Array.prototype.getUnionStr=function(f,d){try{var e=new String();if(!d){d=","}for(var c=0;c<this.length;c++){var a=this[c][f];e+=a+d}e=e.substr(0,e.lastIndexOf(d));return e}catch(b){alert(b)}};String.prototype.toJson=function(){try{var json=eval("("+this.toString()+")");return json}catch(ex){return{}}};String.prototype.messager=function(e){try{var c=this.toJson();var h=c.msg||"";var g=c.title||"操作结果";var d=c.icon||"info";var f=c.action||"show";var a=false;if(f=="show"){$.messager.show({title:g,msg:h,timeout:5000,showType:"slide",showSpeed:500})}else{if(f=="alert"){$.messager.alert(g,h,d,e==null?function(){return true}:e)}else{if(f=="confirm"){$.messager.confirm(g,h,e==null?function(i){return i}:e)}else{if(f=="prompt"){$.messager.prompt(g,h,e==null?function(i){return i}:e)}}}}}catch(b){alert(b);$.messager.alert("Format error","The result is not a Messager format")}};String.prototype.isAlph=function(){return(/^[A-Za-z]+$/.test(this))};String.prototype.isAlphOrNum=function(){return(/^[A-Za-z0-9]+$/.test(this))};String.prototype.isNotSymbol=function(){return !(/[^0-9A-z\u4e00-\u9fa5]/.test(this))};String.prototype.isIdNoFormat=function(){return(/(^\d{15}$)|(^\d{17}([0-9]|X)$)/.test(this))};String.prototype.getIdNoBornDate=function(){var a=this.length;if(a==15){var c="19"+this.slice(6,8);var d=this.slice(8,10);var b=this.slice(10,12);return new Date(c+"/"+d+"/"+b)}if(a==18){var c=this.slice(6,10);var d=this.slice(10,12);var b=this.slice(12,14);return new Date(c+"/"+d+"/"+b)}};String.prototype.isPhoneFormat=function(){return(/^(0[0-9]{2,3}\-)?([2-9][0-9]{6,7})+(\-[0-9]{1,4})?$/).test(this)};String.prototype.isMobileFormat=function(){return(/^((\(\d{3}\))|(\d{3}\-))?13[0-9]\d{8}|15[89]\d{8}/).test(this)};String.prototype.isZipCode=function(){return(/[1-9]\d{5}(?!\d)/.test(this))};String.prototype.isChinese=function(){return(/[\u4e00-\u9fff]+/.test(this))};String.prototype.isFive=function(){return(/^\d{5,5}$/.test(this))};String.prototype.carNo=function(){return(/\d{5}$|[A-Z]{1}\d{4}|\d{1}[A-Z]{1}\d{3}|[A-Z]{2}\d{3}$/.test(this))};String.prototype.ip=function(){return(/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/.test(this))};
/*!
 * "f" is for Format & WHAT THE diff?? v0.5.0
 *
 * Copyright (c) 2009 Joshua Faulkenberry
 * Dual licensed under the MIT and GPL licenses.
 * http://docs.jquery.com/License
 *
 * Date: 2009-03-20 22:15:23 -0700 (Fri, 20 Mar 2009)
 * Revision: 6
 */
window.Date.prototype.format=function(b){var c={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};if(/(y+)/.test(b)){b=b.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))}for(var a in c){if(new RegExp("("+a+")").test(b)){b=b.replace(RegExp.$1,RegExp.$1.length==1?c[a]:("00"+c[a]).substr((""+c[a]).length))}}return b};window.Date.prototype.f=function(J){if(J=="@"){return this.getTime()}else{if(J=="REL"){var r=(((new Date()).getTime()-this.getTime())/1000),f=Math.floor(r/86400);return f==0&&(r>-60&&"right now"||r>-120&&"1 minute from now"||r>-3600&&-(Math.floor(r/60))+" minutes from now"||r>-7200&&"1 hour ago"||r>-86400&&-(Math.floor(r/3600))+" hours from now"||r<60&&"just now"||r<120&&"1 minute ago"||r<3600&&Math.floor(r/60)+" minutes ago"||r<7200&&"1 hour ago"||r<86400&&Math.floor(r/3600)+" hours ago")||f==0&&"Tomorrow"||f>-7&&-(f)+" days from now"||-(Math.ceil(f/7))==1&&"1 week from now"||f>-78&&-(Math.ceil(f/7))+" weeks from now"||f>-730&&-(Math.ceil(f/30))+" months from now"||f<=-730&&-(Math.ceil(f/365))+" years from now"||f==1&&"Yesterday"||f<7&&f+" days ago"||(Math.ceil(f/7))==1&&"1 week ago"||f<78&&Math.ceil(f/7)+" weeks ago"||f<730&&Math.ceil(f/30)+" months ago"||Math.ceil(f/365)+" years ago"}}var n=["January","February","March","April","May","June","July","August","September","October","November","December"],A=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],R=function(c){return(c<0||c>9?"":"0")+c},O=this,J=J+"",o="",z=0,N="",g="",l=O.getYear()+"",i=O.getMonth()+1,L=O.getDate(),q=O.getDay(),p=O.getHours(),C=O.getMinutes(),u=O.getSeconds(),w,x,b,v,P,e,I,G,D,t,S,p,Q,j,a,F,B=new Object();if(l.length<4){l=""+(l-0+1900)}B.y=""+l;B.yyyy=l;B.yy=l.substr(2,4);B.M=i;B.MM=R(i);B.MMM=n[i-1];B.NNN=n[i-1].substr(0,3);B.N=n[i-1].substr(0,1);B.d=L;B.dd=R(L);B.e=A[q].substr(0,1);B.ee=A[q].substr(0,2);B.E=A[q].substr(0,3);B.EE=A[q];B.H=p;B.HH=R(p);if(p==0){B.h=12}else{if(p>12){B.h=p-12}else{B.h=p}}B.hh=R(B.h);if(p>11){B.K=p-12}else{B.K=p}B.k=p+1;B.KK=R(B.K);B.kk=R(B.k);if(p>11){B.a="PM"}else{B.a="AM"}B.m=C;B.mm=R(C);B.s=u;B.ss=R(u);while(z<J.length){N=J.charAt(z);g="";while((J.charAt(z)==N)&&(z<J.length)){g+=J.charAt(z++)}if(B[g]!=null){o=o+B[g]}else{o=o+g}}return o};window.Date.prototype.diff=function(date,breakdown){var options={};if(typeof date=="string"){if((new Date(date))!="Invalid Date"&&(new Date(date))!="NaN"){date=new Date(date)}else{breakdown=date;date=new Date()}}else{if(typeof date=="object"&&!date.getTime){options=date;date=new Date()}}if(typeof breakdown=="object"){options=breakdown;breakdown=options.breakdown||"*"}options.labels=options.labels||{};if(breakdown){function processTime(trg){var result=null;if(diff>=tl[trg]){if(trg=="Y"||trg=="D"||trg=="C"||trg=="T"){for(var yr=(min);yr.getFullYear()<=max.getFullYear();yr.setYear(yr.getFullYear()+1)){if(yr.isLeapYear()){diff-=tl.d}}}if(diff>=tl[trg]){result=Math.floor(diff/tl[trg])+" "+(Math.floor(diff/tl[trg])==1&&names[trg][0]||names[trg][1]);diff=diff%tl[trg]}}eval("breakdown = breakdown.replace(/"+trg+'/g, "")');return result}var min=date<=this&&date||date>this&&this,max=date>this&&date||date<=this&&this,diff=(max.getTime()-min.getTime()),tl={T:1000*60*60*24*365*100*10,C:1000*60*60*24*365*100,D:1000*60*60*24*365*10,Y:1000*60*60*24*365,M:1000*60*60*24*28,W:1000*60*60*24*7,d:1000*60*60*24,H:1000*60*60,m:1000*60,S:1000,N:1},names={T:options.labels.T||["Mellinium","Mellinia"],C:options.labels.C||["Century","Centuries"],D:options.labels.D||["Decade","Decades"],Y:options.labels.Y||["Year","Years"],M:options.labels.M||["Month","Months"],W:options.labels.W||["Week","Weeks"],d:options.labels.d||["Day","Days"],H:options.labels.H||["Hour","Hours"],m:options.labels.m||["Minute","Minutes"],S:options.labels.S||["Second","Seconds"],N:options.labels.N||["Millisecond","Milliseconds"]};if(options.len){for(var x in names){names[x]=names[x].substr(0,options.len)}}var testDt=new Date(min.toString());if(max.getFullYear()-testDt.getFullYear()>1){testDt.setYear(max.getFullYear()-1)}while(testDt<max){if(testDt.isDayLightSavingsDay()&&testDt.getMonth()<5){diff+=tl.H}else{if(testDt.isDayLightSavingsDay()){diff-=tl.H}}testDt.setDate(testDt.getDate()+1)}if(((max.getMonth()==max.getDayLightSavingsDays()[0].getMonth()&&max.getDate()<max.getDayLightSavingsDays()[0].getDate())||max.getMonth()<max.getDayLightSavingsDays()[0].getMonth())&&max.getMonth()==min.getMonth()){diff+=tl.H}else{if(((min.getMonth()==min.getDayLightSavingsDays()[1].getMonth()&&min.getDate()>min.getDayLightSavingsDays()[1].getDate())||min.getMonth()<min.getDayLightSavingsDays()[1].getMonth())&&min.getMonth()==min.getMonth()){diff-=tl.H}}var result=[],out;while(diff>0){if(breakdown=="*"){breakdown="TCDYMWdHmSN"}else{if(breakdown.indexOf("T")>-1){if(out=processTime("T")){result[result.length]=out}}else{if(breakdown.indexOf("C")>-1){if(out=processTime("C")){result[result.length]=out}}else{if(breakdown.indexOf("D")>-1){if(out=processTime("D")){result[result.length]=out}}else{if(breakdown.indexOf("Y")>-1){if(out=processTime("Y")){result[result.length]=out}}else{if(breakdown.indexOf("M")>-1){if(diff>=tl.M){var cur=(new Date(max.getTime()-diff));var monthCount=0;var lastVal=0;for(var yr=cur.getFullYear();yr<=max.getFullYear();yr++){while(cur.getFullYear()==yr){lastVal=cur.getTime();cur.setMonth(cur.getMonth()+1);if(diff-(cur.getTime()-lastVal)>=0){monthCount++;diff-=(cur.getTime()-lastVal)}if(yr==max.getFullYear()&&cur.getMonth()==max.getMonth()){break}}}if(monthCount){result[result.length]=monthCount+" "+(monthCount==1&&names.M[0]||names.M[1])}}breakdown=breakdown.replace(/M/g,"")}else{if(breakdown.indexOf("W")>-1){if(out=processTime("W")){result[result.length]=out}}else{if(breakdown.indexOf("d")>-1){if(out=processTime("d")){result[result.length]=out}}else{if(breakdown.indexOf("H")>-1){if(out=processTime("H")){result[result.length]=out}}else{if(breakdown.indexOf("m")>-1){if(out=processTime("m")){result[result.length]=out}}else{if(breakdown.indexOf("S")>-1){if(out=processTime("S")){result[result.length]=out}}else{if(breakdown.indexOf("N")>-1){if(out=processTime("N")){result[result.length]=out}}else{diff=0}}}}}}}}}}}}}options.divider=options.divider||", ";if(options.divider==", "&&result.length>1&&!options.hideAnd){result[result.length-1]="and "+result[result.length-1]}diff=result.join(options.divider)}if(diff==""){diff="Same"}if(options.lc){diff=diff.toLowerCase()}return diff};window.Date.prototype.getDaysInMonth=function(){return[31,28,31,30,31,30,31,31,30,31,30,31][this.getMonth()]};window.Date.prototype.isLeapYear=function(){return(new Date(this.getFullYear(),2-1,29)).getDate()==29};window.Date.prototype.getDayLightSavingsDays=function(){var a=[];var c=new Date("03/07/"+this.getFullYear());var b=new Date("03/06/"+this.getFullYear());while(c.getMonth()<3||(c.getMonth()==3&&c.getDate()<16)){if((c.getTime()-b.getTime())/1000/60/60!=24){a[a.length]=new Date(b.getTime())}c.setDate(c.getDate()+1);b.setDate(b.getDate()+1)}var c=new Date("10/31/"+this.getFullYear());var b=new Date("10/30/"+this.getFullYear());while(c.getMonth()<11||(c.getMonth()==10&&c.getDate()<9)){if((c.getTime()-b.getTime())/1000/60/60!=24){a[a.length]=new Date(b.getTime())}c.setDate(c.getDate()+1);b.setDate(b.getDate()+1)}return a};window.Date.prototype.isDayLightSavingsDay=function(){var a=new Date(this.getTime());a.setDate(a.getDate()+1);return(a.getTime()-this.getTime())/1000/60/60!=24};jQuery.fn.extend({kiaLoadFields:function(){$(this).find("input:enabled").each(function(){if($(this).hasClass("easyui-combobox")){$(this).combobox()}else{if($(this).hasClass("kia-intbox")){$(this).kiaIntbox()}else{if($(this).hasClass("kia-doublebox")){$(this).kiaDoublebox()}else{if($(this).hasClass("kia-combogrid")){$(this).kiaCombogrid()}else{if($(this).hasClass("kia-datebox")){$(this).kiaDatebox()}}}}}});return true},kiaIframe:function(a){$(this).html("<iframe scrolling='no' frameborder='0' src='"+a+"' style='width:99%;height:99%;overflow:hidden;'></iframe>")},kiaAuthFields:function(a){var b=$(this);if(!a){return false}b.find("input").each(function(){var d=$(this).attr("name")||null;if(d){var c=a[d];switch(c){case 0:$(this).addClass("invisible").attr("disabled","disabled");break;case 1:$(this).addClass("readonly").attr("readonly","true");break;default:$(this).addClass("editable")}}});return true},kiaCombogrid:function(opts){var thisObj=$(this);var thisName=thisObj.attr("name");var thisValueField=thisObj.attr("valueField")||"Id";var thisTextField=thisObj.attr("textField")||"Name";var thisUrl=thisObj.attr("url")||"";var thisRequired=thisObj.attr("required")||true;var selecterWidth=thisObj.attr("selecterWidth")||80;var thisDisabled=thisObj.attr("disabled");var thisDataEval=thisObj.attr("dataEval")||"";if(opts){thisValueField=opts.valueField||"Id";thisTextField=opts.textField||"Name";thisUrl=opts.url||"";thisRequired=opts.required||true;selecterWidth=opts.selecterWidth||80;thisDisabled=opts.disabled;thisDataEval=opts.dataEval||""}var thisWidth=thisObj.width();var thisHeight=thisObj.height();thisObj.width(thisWidth-selecterWidth);var thisValue=thisObj.val()||"";var selecterObj=$("<input>").width(selecterWidth);thisObj.before(selecterObj);thisObj.combobox({hasDownArrow:false,editable:false,required:thisRequired,textField:thisTextField,valueField:thisValueField});selecterObj.combogrid({panelWidth:thisWidth,disabled:thisDisabled,idField:thisValueField,textField:thisValueField,value:thisValue,columns:[[{field:thisValueField,width:selecterWidth},{field:thisTextField,width:thisWidth}]],onChange:function(nv,ov){if(!nv||!ov||nv==ov){return}thisObj.combobox("select",nv)},onSelect:function(index,r){thisObj.combobox("select",r[thisValueField])}});var gridData=eval(thisDataEval);if(gridData){var grid=selecterObj.combogrid("grid");grid.datagrid("loadData",gridData);thisObj.combobox("loadData",gridData.rows)}else{if(thisUrl!=""){$.getJSON(thisUrl,function(gridData){grid.datagrid("loadData",gridData);thisObj.combobox("loadData",gridData.rows)})}}},kiaDatebox2:function(){try{var c=$(this);var b=c.attr("value")||"";var a="";if(b!=""){var g=Date.parse(b);a=g.toString(Kia.custom.setting.dbDateFormat);c.val(a)}c.datebox({onChange:Kia.easyui.datebox.onChangeHandler,onSelect:function(d){c.datebox("setValue",d.format(Kia.custom.setting.dbDateFormat))}});var f=c.next().find("input:first");f.blur(function(){if($(this).val()==null||$(this).val()==""){return}var h=Kia.util.isDateFormat(Kia.custom.setting.dbDateFormat,$(this).val());if(h){var j=dateboxObj.datebox("calendar");var i=j.calendar("options");var k=i.current;c.datebox("setValue",k.format(Kia.custom.setting.dbDateFormat))}else{$.messager.show({title:"输入错误",msg:"日期格式必须符合"+Kia.custom.setting.dbDateFormat});c.datebox("setValue",a)}})}catch(e){alert(e)}},kiaDatebox:function(){var c=$(this);var b=c.attr("value")||"";var a="";if(b!=""){try{var f=new Date(b);a=f.toString(Kia.custom.setting.dbDateFormat);c.val(a)}catch(e){alert(e)}}else{c.val("")}c.datebox({validType:"date['yyyy-MM-dd']"})},kiaDoublebox:function(){$(this).numberbox({increment:10,precision:Kia.setting.precision})},kiaIntbox:function(){$(this).numberbox({increment:10,precision:0})},kiaCrudForm:function(b){try{var f=b.prefix||"";var c=b.colNum||2;var l=b.editors||[];var o=b.urlSave||"";var d=b.urlRemove||"";var e=b.data||{};var p=$("<div></div>");p.css("overflow","hidden");var i=$("<form method='post'></form>");var h=$("<table cellspacing='0' ></table>");h.addClass("editTable");h.css("table-layout","auto");$.each(e,function(q,s){var r=$('<input type="hidden" />');r.attr("name",f+q).attr("value",s);i.append(r)});var m;$.each(l,function(x,w){if(x%c==0){m=$("<tr></tr>")}var y=w.field||"";var s=w.title||"";var z="input[name='"+f+y+"']";i.find("input").remove(z);var u=$("<td>&nbsp;</td>");var r=$("<th>&nbsp;</th>");var A=w.editor||{type:"text"};var q=A.type;var v=A.options||{};var t;if(q=="textarea"){t=$("<textarea rows='3'></textarea>");t.html(e[y])}else{if(q=="checkbox"){t=$("<input type='checkbox' value='Y' />")}else{t=$("<input type='text' />");t.val(e[y])}}t.css("width","90%").attr("name",f+y);var B=$("<span></span>");B.html(s);u.append(t);r.append(B).append(":");m.append(r);m.append(u);if(x%c==c-1||x==l.length-1){h.append(m)}switch(q){case"validatebox":t.validatebox(v);break;case"datebox":t.datebox(v);break;case"numberbox":t.numberspinner(v);break;case"combobox":t.combobox(v);break;case"combotree":t.combotree(v);break;default:t.validatebox(v);break}});var n=$("<tr></tr>");var k=$("<th></th>");k.css("padding-right","3%");n.append(k);k.attr("colspan",c*2);var g=$("<a></a>");var a=$("<a></a>");k.append(g);k.append(a);g.linkbutton({text:"保存",iconCls:"icon-save"});a.linkbutton({text:"清空",iconCls:"icon-cancel"});g.click(function(){$.messager.confirm("操作提示","确认保存数据？",function(q){if(q){i.form("submit",{url:o,onSubmit:function(){return $(this).form("validate")},success:function(r){r.messager()}})}})});a.click(function(){i.form("clear")});h.append(n);i.append(h);p.append(i);$(this).html(p)}catch(j){alert(j)}},kiaUploadForm:function(a){if(!a){a={}}var i=a.uploadUrl||"#";var g=a.inputName||"file";var c=a.muti||false;var b=$("<div></div>");var m=$("<table></table>");var h=$("<ol type='1'></ol>");var k=$("<span></span>");var d=$("<form method='post' enctype='multipart/form-data'></form>");d.attr("action",i);var e=$("<a></a>");var f=$("<a></a>");e.linkbutton({text:"新增",iconCls:"icon-add"});f.linkbutton({text:"提交",iconCls:"icon-save"});e.click(function(){var n=$("<li></li>");var p=$("<input type='file' />");p.attr("name",g);var o=$("<button type='button'>删除</button>");o.click(function(){n.remove()});n.append(p).append("&nbsp;&nbsp;").append(o);h.append(n)});f.click(function(){d.form("submit")});if(c){k.append(e)}k.append(f);var l=$("<li></li>");var j=$("<input type='file' />");j.attr("name",g);l.append(j);h.append(l);b.css("padding","1%");k.css("width","100%").css("text-align","right").css("padding-right","5%");d.append(h);d.append(k);b.append(d);$(this).html(b)}});$.extend($.fn.validatebox.defaults.rules,{minLength:{validator:function(a,b){return a.length>=b[0]},message:"Please enter at least {0} characters."},datetime:{validator:function(b,c){var a=c[0]||Kia.custom.setting.dbDateFormat;return Kia.util.isDateFormat(a,b)},message:"日期格式必须符合 {0}"},idCard:{validator:function(a,b){return a.isIdNoFormat()},message:"身份证格式错误"},zip:{validator:function(a,b){return a.isZipCode()},message:"邮政编码格式错误"},phone:{validator:function(a,b){return a.isPhoneFormat()},message:"电话号码格式错误"},mobile:{validator:function(a,b){return a.isMobileFormat()},message:"手机号码格式错误"},Chinese:{validator:function(a,b){return a.isChinese()},message:"只能是中文"},five:{validator:function(a,b){return a.isFive()},message:"输入格式错误"},carno:{validator:function(a,b){return a.carNo()},message:"车牌输入格式错误"},ip:{validator:function(a,b){return a.ip()},message:"IP输入格式错误"}});$.fn.datebox.defaults.formatter=function(a){if(a){return a.format(Kia.custom.setting.dbDateFormat)}else{return""}};$.fn.datebox.defaults.parser=function(a){if(a&&Kia.util.isDateFormat(Kia.custom.setting.dbDateFormat,a)){return Kia.util.parseDateTime(Kia.custom.setting.dbDateFormat,a)}else{return new Date()}};$.fn.panel.defaults.onMove=function(h,g){if(h<0){$(this).panel("move",{left:10})}if(g<0){$(this).panel("move",{top:10})}var d=h+$(this).width();var e=g+$(this).height();var i=parseInt(window.innerWidth);var c=parseInt(window.innerHeight);if(d>i){var f=i-$(this).width()-30;$(this).panel("move",{left:f})}if(e>c){var a=c-$(this).height()-50;$(this).panel("move",{top:a})}};$.fn.window.defaults.onMove=$.fn.panel.defaults.onMove;$.fn.dialog.defaults.onMove=$.fn.panel.defaults.onMove;$.fn.window.defaults.shadow=false;$.fn.form.defaults.success=function(a){a.messager(null)};$.fn.form.defaults.onSubmit=function(){return $(this).form("validate")};$.fn.form.defaults.onLoadError=function(){$.messager.alert("Error","Can't access to the remote site.","error")};$.fn.datagrid.defaults.fit=true;$.fn.datagrid.defaults.pagination=true;$.fn.datagrid.defaults.nowrap=false;$.fn.datagrid.defaults.idField="Id";$.fn.datagrid.defaults.rownumbers=true;$.fn.datagrid.defaults.pageSize=20;$.fn.datagrid.defaults.groupFormatter=function(b,a){return b+" - 共"+a.length+" 条"};var CrudDatagrid=function(a){this._urlAdd=a.urlAdd||"";this._urlRemove=a.urlRemove||"";this._urlUpdate=a.urlUpdate||"";this._urlExportExcel=a.urlExportExcel||"";this._regexp=a.regexp||"";this._id=a.id||"Id";this._initRow=a.initRow||function(){return{}};this._editors=a.editors};CrudDatagrid.prototype.getToolbar=function(a){a=a||{};var d=a.textBtnAdd||"新建";var o=new this._initRow();var h=this._regexp;var c=this._id;var f=this._urlRemove;var j=this._urlAdd;var e=this._urlUpdate;var b=this._urlExportExcel;var m={};m.editors=this._editors;m.prefix=a.prefix||"";var g={iconCls:"icon-add",text:d,handler:function(){m.data=o;m.urlSave=j;var q=$("<div></div>");q.kiaCrudForm(m);q.dialog({title:"新建记录",modal:true,onClose:function(){$(this).dialog("destroy",true)},onDestroy:function(){$(h).datagrid("reload")}})}};var l={iconCls:"icon-edit",text:"修改",handler:function(){var q=$(h).datagrid("getSelected");if(!q){$.messager.alert("","没有记录被选中","error");return}var t=$(h).datagrid("getRowIndex",q);m.data=q;m.urlSave=e;var r="修改记录序号:"+(t+1);var s=$("<div></div>");s.kiaCrudForm(m);s.dialog({title:r,modal:true,onClose:function(){$(this).dialog("destroy",true)},onDestroy:function(){$(h).datagrid("reload")}})}};var n={iconCls:"icon-remove",text:"删除",handler:function(){var q=$(h).datagrid("getSelections");var s=q.length;if(s==0){$.messager.alert("","没有记录被选中","error");return}var r="";r=q.getUnionStr(c,",");$.messager.confirm("操作提示","是否删除"+s+"条记录",function(t){if(t){$.post(f,{ids:r},function(w){try{var v=new String(w);v.messager();$(h).datagrid("clearSelections");$(h).datagrid("reload")}catch(u){alert(u)}})}})}};var k={iconCls:"icon-reload",text:"刷新",handler:function(){$(h).datagrid("reload")}};var p={iconCls:"icon-help",text:"导出excel",handler:function(){if(b.length<1){$.messager.alert("操作错误","没有配置excel路径","error");return}var q=$("<div></div>");var y=$("<table></table>");y.css("padding","10px");var w;var r;var t;var s;var x;w=$("<tr></tr>");r=$("<th></th>");t=$("<td></td>");s=$("<td></td>");x=$("<a></a>");var u=$(h).datagrid("getData")["total"]||0;r.html("全部记录数:");t.html(u).css("width","100px");s.css("width","120px");x.attr("href",b);s.append(x);x.linkbutton({text:"导出"});w.append(r).append(t).append(s);y.append(w);w=$("<tr></tr>");r=$("<th></th>");t=$("<td></td>");s=$("<td></td>");x=$("<a></a>");var v=$(h).datagrid("getSelections").length||0;r.html("已选记录数:");t.html(v);x.attr("href",b);s.append(x);x.linkbutton({text:"导出"});w.append(r).append(t).append(s);y.append(w);w=$("<tr></tr>");r=$("<th></th>");t=$("<td></td>");s=$("<td></td>");x=$("<a></a>");var z=$(h).datagrid("getRows").length||0;r.html("当前页记录数:");t.html(z);x.attr("href",b);s.append(x);x.linkbutton({text:"导出"});w.append(r).append(t).append(s);y.append(w);q.append(y);q.dialog({title:"导出excel"})}};var i=[g,l,n,k,p];return i};CrudDatagrid.prototype.getOperaFormatter=function(){try{var i=new this._initRow();var f=this._regexp;var a=this._id;var d=this._urlRemove;var g=this._urlAdd;var c=this._urlUpdate;var h={};h.editors=this._editors;var b=function(m,p,k){var l=$("<span></span>");var j=$("<a id='aEdit'></a>");var o=$("<a></a>");var n="$('<div></div>').dialog({width:600,height:400});";l.append(j);l.find("#aEdit").attr("title","编辑").attr("href","javascript:void(0)").addClass("kia-icon").addClass("edit").attr("onclick",n);alert(l.html());return l.html()};return b}catch(e){alert(e)}};CrudDatagrid.prototype.getEditRowHandler=function(d){d=d||{};var g=this._regexp;var h=this._id;var c=this._urlRemove;var f=this._urlAdd;var b=this._urlUpdate;var e={};e.editors=this._editors;e.prefix=d.prefix||"";var a=function(n,k){e.data=k;e.urlSave=b;var j=parseInt(n);var l="修改记录序号:"+(j+1);var m=$("<div></div>");m.kiaCrudForm(e);m.dialog({title:l,modal:true,onClose:function(){$(this).dialog("destroy",true)},onDestroy:function(){$(g).datagrid("reload")}})};return a};function dateboxFormatter(c,e,b){if(c==null||c==""){return""}var d="";if(typeof(c)=="number"){var a=new Date();a.setTime(c);return a.toString("yyyy-MM-dd")}else{return c}}function dateTimeboxFormatter(c,d,b){if(c==null||c==""){return""}var a=new Date();a.setTime(c);if(a==null){return c}return a.toString("yyyy-MM-dd HH:mm:ss")};